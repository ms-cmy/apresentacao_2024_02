name: Terraform deployment
on:
  push:
    branches: [ "master" ]
    # paths: 
    #   - 'terraform/**'

jobs:

  build:

    runs-on: ubuntu-latest
  
    steps:
      - name: Checkout the repository to the runner
        uses: actions/checkout@v2
  
      - name: Setup Terraform with specified version on the runner
        uses: hashicorp/setup-terraform@v2
      
      - name: auth to google
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: ${{ secrets.GOOGLE_CREDENTIALS }}
      
      - name: terraform init
        run: | 
          cd terraform
          terraform init
          terraform plan -out
          terraform validate